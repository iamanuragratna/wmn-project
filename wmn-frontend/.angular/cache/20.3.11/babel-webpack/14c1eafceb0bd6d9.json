{"ast":null,"code":"import { HttpClientModule } from '@angular/common/http';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n// standalone child components / pipes (these must match your files)\nimport { NodeListComponent } from './components/node-list/node-list.component';\nimport { TelemetryChartComponent } from './components/telemetry-chart/telemetry-chart.component';\nimport { ForecastChartComponent } from './components/forecast-chart/forecast-chart.component';\nimport { PlanViewComponent } from './components/plan-view/plan-view.component';\nimport { CommandHistoryComponent } from './components/command-history/command-history.component';\nimport { AdminPanelComponent } from './components/admin-panel/admin-panel.component';\nimport { AlertsComponent } from './components/alerts/alerts.component';\nimport { ObservabilityComponent } from './components/observability/observability.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/websocket.service\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"@angular/common\";\nfunction AppComponent_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const l_r1 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(l_r1);\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AppComponent {\n    constructor(ws, http) {\n      this.ws = ws;\n      this.http = http;\n      this.nodes = {};\n      this.telemetry = {};\n      this.forecasts = {};\n      this.plans = [];\n      this.commands = [];\n      this.logs = [];\n    }\n    ngOnInit() {\n      this.sub = this.ws.messages$.subscribe(msg => {\n        try {\n          const {\n            type,\n            payload\n          } = msg;\n          if (type === 'feature_update') {\n            const nodeId = payload.nodeId;\n            this.logs.push(`feature_update ${nodeId}`);\n            // build a new telemetry array for this node (immutable update)\n            const nodeArr = (this.telemetry[nodeId] || []).concat([{\n              ts: payload.windowEnd,\n              busy: payload.avgChannelBusyPercent,\n              rssi: payload.avgRssi,\n              txBytes: payload.sumTxBytes\n            }]);\n            // keep array length sane\n            const trimmed = nodeArr.length > 200 ? nodeArr.slice(nodeArr.length - 200) : nodeArr;\n            // immutable update of telemetry object so child @Input sees new reference\n            this.telemetry = {\n              ...this.telemetry,\n              [nodeId]: trimmed\n            };\n            // update nodes summary (immutable)\n            const updatedNode = {\n              ...(this.nodes[nodeId] || {}),\n              lastSeen: payload.lastSeen,\n              lastRssi: payload.avgRssi,\n              channelBusy: payload.avgChannelBusyPercent,\n              clients: payload.sampleCount\n            };\n            this.nodes = {\n              ...this.nodes,\n              [nodeId]: updatedNode\n            };\n          } else if (type === 'forecast_update') {\n            const nodeId = payload.nodeId;\n            this.logs.push(`forecast_update ${nodeId}`);\n            // immutable update of forecasts map\n            this.forecasts = {\n              ...this.forecasts,\n              [nodeId]: payload\n            };\n          } else if (type === 'optimizer_plan') {\n            const nodeId = payload.nodeId;\n            this.logs.push(`optimizer_plan ${nodeId}`);\n            // keep newest at front\n            const newPlan = {\n              ...payload,\n              status: 'pending',\n              ts: new Date().toISOString()\n            };\n            this.plans = [newPlan, ...this.plans].slice(0, 200);\n            // keep a node suggestedChannel copy too (optional)\n            if (payload.channel) {\n              this.nodes = {\n                ...this.nodes,\n                [nodeId]: {\n                  ...(this.nodes[nodeId] || {}),\n                  suggestedChannel: payload.channel\n                }\n              };\n            }\n          } else if (type === 'command_status') {\n            const nodeId = payload.nodeId;\n            this.logs.push(`command_status ${nodeId}`);\n            const newCmd = {\n              ...payload,\n              ts: new Date().toISOString()\n            };\n            this.commands = [newCmd, ...this.commands].slice(0, 200);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      });\n      this.ws.connect();\n    }\n    ngOnDestroy() {\n      if (this.sub) this.sub.unsubscribe();\n      this.ws.disconnect();\n    }\n    sendManualCommand(nodeId, channel) {\n      const body = {\n        nodeId,\n        command: 'SET_CHANNEL',\n        payload: String(channel),\n        triggeredBy: 'manual'\n      };\n      this.http.post('/api/controller/commands', body).subscribe({\n        next: () => this.logs.push(`Manual command sent ${nodeId}->${channel}`),\n        error: err => {\n          this.logs.push('Manual command failed');\n          console.error('[AppComponent] manual command error', err);\n        }\n      });\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AppComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AppComponent)(i0.ɵɵdirectiveInject(i1.WebsocketService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AppComponent,\n      selectors: [[\"app-root\"]],\n      decls: 36,\n      vars: 7,\n      consts: [[1, \"app-shell\"], [1, \"app-header\"], [2, \"margin\", \"0\", \"font-size\", \"16px\"], [1, \"app-body\"], [1, \"app-grid\"], [1, \"card\"], [3, \"sendCommand\", \"nodes\"], [3, \"telemetry\"], [2, \"height\", \"12px\"], [3, \"forecasts\"], [3, \"plans\"], [3, \"commands\"], [3, \"send\"], [1, \"card\", \"logs\"], [2, \"font-weight\", \"600\", \"margin-bottom\", \"6px\"], [1, \"content-scroll\"], [4, \"ngFor\", \"ngForOf\"]],\n      template: function AppComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h3\", 2);\n          i0.ɵɵtext(3, \"WMN Telemetry Control Panel\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(4, \"div\", 3)(5, \"div\", 4)(6, \"div\")(7, \"div\", 5)(8, \"app-node-list\", 6);\n          i0.ɵɵlistener(\"sendCommand\", function AppComponent_Template_app_node_list_sendCommand_8_listener($event) {\n            return ctx.sendManualCommand($event.nodeId, $event.channel);\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(9, \"div\")(10, \"div\", 5);\n          i0.ɵɵelement(11, \"app-telemetry-chart\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(12, \"div\", 8);\n          i0.ɵɵelementStart(13, \"div\", 5);\n          i0.ɵɵelement(14, \"app-forecast-chart\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(15, \"div\", 8);\n          i0.ɵɵelementStart(16, \"div\", 5);\n          i0.ɵɵelement(17, \"app-plan-view\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"div\")(19, \"div\", 5);\n          i0.ɵɵelement(20, \"app-command-history\", 11);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(21, \"div\", 8);\n          i0.ɵɵelementStart(22, \"div\", 5)(23, \"app-admin-panel\", 12);\n          i0.ɵɵlistener(\"send\", function AppComponent_Template_app_admin_panel_send_23_listener($event) {\n            return ctx.sendManualCommand($event.nodeId, $event.channel);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelement(24, \"div\", 8);\n          i0.ɵɵelementStart(25, \"div\", 5);\n          i0.ɵɵelement(26, \"app-alerts\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(27, \"div\", 8);\n          i0.ɵɵelementStart(28, \"div\", 5);\n          i0.ɵɵelement(29, \"app-observability\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(30, \"div\", 8);\n          i0.ɵɵelementStart(31, \"div\", 13)(32, \"div\", 14);\n          i0.ɵɵtext(33, \"Logs\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(34, \"div\", 15);\n          i0.ɵɵtemplate(35, AppComponent_div_35_Template, 2, 1, \"div\", 16);\n          i0.ɵɵelementEnd()()()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(8);\n          i0.ɵɵproperty(\"nodes\", ctx.nodes);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"telemetry\", ctx.telemetry);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"forecasts\", ctx.forecasts);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"plans\", ctx.plans);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"commands\", ctx.commands);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"telemetry\", ctx.telemetry);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngForOf\", ctx.logs);\n        }\n      },\n      dependencies: [CommonModule, i3.NgForOf, HttpClientModule, FormsModule,\n      // child standalone components / pipes\n      NodeListComponent, TelemetryChartComponent, ForecastChartComponent, PlanViewComponent, CommandHistoryComponent, AdminPanelComponent, AlertsComponent, ObservabilityComponent],\n      styles: [\".header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:#071024;color:#e6eef8}.container[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr 360px;gap:12px;padding:12px}.card[_ngcontent-%COMP%]{background:linear-gradient(180deg,#ffffff05,#ffffff03);border-radius:10px;padding:12px;color:inherit}.left[_ngcontent-%COMP%]{overflow:auto;height:calc(100vh - 120px)}.center[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.right[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;overflow:auto;height:calc(100vh - 120px)}.log[_ngcontent-%COMP%]{height:160px;overflow:auto;font-family:monospace;font-size:12px}\"]\n    }));\n  }\n  _staticBlock();\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}