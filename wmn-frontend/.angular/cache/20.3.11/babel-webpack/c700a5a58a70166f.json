{"ast":null,"code":"import { Client } from '@stomp/stompjs';\nimport * as SockJS from 'sockjs-client';\nimport { Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let WebsocketService = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class WebsocketService {\n    constructor() {\n      this.url = 'http://localhost:8085/ws/telemetry';\n      this.messages$ = new Subject();\n    }\n    connect() {\n      if (this.client && this.client.connected) return;\n      const sockFactory = () => new SockJS(this.url);\n      this.client = new Client({\n        brokerURL: undefined,\n        webSocketFactory: sockFactory,\n        reconnectDelay: 5000,\n        debug: str => console.log('[STOMP]', str),\n        onConnect: frame => {\n          console.log('[STOMP] connected', frame);\n          this.client?.subscribe('/topic/telemetry', m => {\n            if (m.body) {\n              try {\n                const obj = JSON.parse(m.body);\n                if (obj.type && obj.payload) {\n                  this.messages$.next(obj);\n                } else {\n                  const t = obj.type || obj.msgType || (obj.nodeId && obj.avgChannelBusyPercent ? 'feature_update' : obj.forecastBusyPercent ? 'forecast_update' : 'unknown');\n                  this.messages$.next({\n                    type: t,\n                    payload: obj\n                  });\n                }\n              } catch (e) {\n                console.error('parse err', e);\n              }\n            }\n          });\n        },\n        onStompError: frame => console.error('STOMP error', frame)\n      });\n      this.client.activate();\n    }\n    disconnect() {\n      this.client?.deactivate();\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function WebsocketService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || WebsocketService)();\n    }, this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: WebsocketService,\n      factory: WebsocketService.ɵfac,\n      providedIn: 'root'\n    }));\n  }\n  _staticBlock();\n  return WebsocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}