{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/websocket.service\";\nimport * as i2 from \"@angular/common/http\";\nfunction AppComponent_div_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵdomElementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵdomElementEnd();\n  }\n  if (rf & 2) {\n    const l_r1 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(l_r1);\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AppComponent {\n    constructor(ws, http) {\n      this.ws = ws;\n      this.http = http;\n      this.nodes = {};\n      this.telemetry = {};\n      this.forecasts = {};\n      this.plans = [];\n      this.commands = [];\n      this.logs = [];\n    }\n    ngOnInit() {\n      this.sub = this.ws.messages$.subscribe(msg => {\n        try {\n          const {\n            type,\n            payload\n          } = msg;\n          if (type === 'feature_update') {\n            this.logs.push(`feature_update ${payload.nodeId}`);\n            this.telemetry[payload.nodeId] = this.telemetry[payload.nodeId] || [];\n            this.telemetry[payload.nodeId].push({\n              ts: payload.windowEnd,\n              busy: payload.avgChannelBusyPercent,\n              rssi: payload.avgRssi,\n              txBytes: payload.sumTxBytes\n            });\n            if (this.telemetry[payload.nodeId].length > 200) this.telemetry[payload.nodeId].shift();\n            this.nodes[payload.nodeId] = {\n              lastSeen: payload.lastSeen,\n              lastRssi: payload.avgRssi,\n              channelBusy: payload.avgChannelBusyPercent,\n              clients: payload.sampleCount\n            };\n          } else if (type === 'forecast_update') {\n            this.logs.push(`forecast_update ${payload.nodeId}`);\n            this.forecasts[payload.nodeId] = payload;\n          } else if (type === 'optimizer_plan') {\n            this.logs.push(`optimizer_plan ${payload.nodeId}`);\n            this.plans.unshift({\n              ...payload,\n              status: 'pending',\n              ts: new Date().toISOString()\n            });\n            if (this.plans.length > 200) this.plans.pop();\n            this.nodes[payload.nodeId] = {\n              ...(this.nodes[payload.nodeId] || {}),\n              suggestedChannel: payload.channel\n            };\n          } else if (type === 'command_status') {\n            this.logs.push(`command_status ${payload.nodeId}`);\n            this.commands.unshift({\n              ...payload,\n              ts: new Date().toISOString()\n            });\n            if (this.commands.length > 200) this.commands.pop();\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      });\n      this.ws.connect();\n    }\n    ngOnDestroy() {\n      if (this.sub) this.sub.unsubscribe();\n      this.ws.disconnect();\n    }\n    sendManualCommand(nodeId, channel) {\n      const body = {\n        nodeId,\n        command: 'SET_CHANNEL',\n        payload: String(channel),\n        triggeredBy: 'manual'\n      };\n      this.http.post('/api/controller/commands', body).subscribe({\n        next: () => this.logs.push(`Manual command sent ${nodeId}->${channel}`),\n        error: () => this.logs.push('Manual command failed')\n      });\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AppComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AppComponent)(i0.ɵɵdirectiveInject(i1.WebsocketService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AppComponent,\n      selectors: [[\"app-root\"]],\n      decls: 40,\n      vars: 7,\n      consts: [[1, \"header\"], [1, \"container\"], [1, \"left\", \"card\"], [3, \"sendCommand\", \"nodes\"], [1, \"center\"], [1, \"card\"], [3, \"telemetry\"], [3, \"forecasts\"], [3, \"plans\"], [1, \"right\"], [3, \"commands\"], [3, \"send\"], [1, \"card\", \"log\"], [4, \"ngFor\", \"ngForOf\"]],\n      template: function AppComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵdomElementStart(0, \"div\", 0)(1, \"h1\");\n          i0.ɵɵtext(2, \"WMN Telemetry Control Panel\");\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(3, \"div\", 1)(4, \"div\", 2)(5, \"h3\");\n          i0.ɵɵtext(6, \"Nodes\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(7, \"app-node-list\", 3);\n          i0.ɵɵdomListener(\"sendCommand\", function AppComponent_Template_app_node_list_sendCommand_7_listener($event) {\n            return ctx.sendManualCommand($event.nodeId, $event.channel);\n          });\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(8, \"div\", 4)(9, \"div\", 5);\n          i0.ɵɵdomElement(10, \"app-telemetry-chart\", 6);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(11, \"div\", 5)(12, \"h4\");\n          i0.ɵɵtext(13, \"Forecasts\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElement(14, \"app-forecast-chart\", 7);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(15, \"div\", 5)(16, \"h4\");\n          i0.ɵɵtext(17, \"Optimizer Plans\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElement(18, \"app-plan-view\", 8);\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(19, \"div\", 9)(20, \"div\", 5)(21, \"h4\");\n          i0.ɵɵtext(22, \"Commands\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElement(23, \"app-command-history\", 10);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(24, \"div\", 5)(25, \"h4\");\n          i0.ɵɵtext(26, \"Admin\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(27, \"app-admin-panel\", 11);\n          i0.ɵɵdomListener(\"send\", function AppComponent_Template_app_admin_panel_send_27_listener($event) {\n            return ctx.sendManualCommand($event.nodeId, $event.channel);\n          });\n          i0.ɵɵdomElementEnd()();\n          i0.ɵɵdomElementStart(28, \"div\", 5)(29, \"h4\");\n          i0.ɵɵtext(30, \"Alerts\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElement(31, \"app-alerts\", 6);\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(32, \"div\", 5)(33, \"h4\");\n          i0.ɵɵtext(34, \"Observability\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElement(35, \"app-observability\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomElementStart(36, \"div\", 12)(37, \"h4\");\n          i0.ɵɵtext(38, \"Logs\");\n          i0.ɵɵdomElementEnd();\n          i0.ɵɵdomTemplate(39, AppComponent_div_39_Template, 2, 1, \"div\", 13);\n          i0.ɵɵdomElementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵdomProperty(\"nodes\", ctx.nodes);\n          i0.ɵɵadvance(3);\n          i0.ɵɵdomProperty(\"telemetry\", ctx.telemetry);\n          i0.ɵɵadvance(4);\n          i0.ɵɵdomProperty(\"forecasts\", ctx.forecasts);\n          i0.ɵɵadvance(4);\n          i0.ɵɵdomProperty(\"plans\", ctx.plans);\n          i0.ɵɵadvance(5);\n          i0.ɵɵdomProperty(\"commands\", ctx.commands);\n          i0.ɵɵadvance(8);\n          i0.ɵɵdomProperty(\"telemetry\", ctx.telemetry);\n          i0.ɵɵadvance(8);\n          i0.ɵɵdomProperty(\"ngForOf\", ctx.logs);\n        }\n      },\n      styles: [\".header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;background:#071024;color:#e6eef8}.container[_ngcontent-%COMP%]{display:grid;grid-template-columns:320px 1fr 360px;gap:12px;padding:12px}.card[_ngcontent-%COMP%]{background:linear-gradient(180deg,#ffffff05,#ffffff03);border-radius:10px;padding:12px;color:inherit}.left[_ngcontent-%COMP%]{overflow:auto;height:calc(100vh - 120px)}.center[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.right[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;overflow:auto;height:calc(100vh - 120px)}.log[_ngcontent-%COMP%]{height:160px;overflow:auto;font-family:monospace;font-size:12px}\"]\n    }));\n  }\n  _staticBlock();\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}